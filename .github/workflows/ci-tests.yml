# This file was generated by [xtask-base](https://github.com/simon-bourne/rust-xtask-base).
# Please do not edit!
name: ci-tests
on:
  push:
  pull_request:
jobs:
  lints-ubuntu-latest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: nightly-2023-10-14
        profile: minimal
        default: true
        components: rustfmt
    - uses: Swatinem/rust-cache@v2
    - run: |
        sudo apt-get update
        sudo apt-get install -y webkit2gtk-4.0
    - run: mkdir -p examples/tauri/frontend/dist
    - run: cargo fmt --all -- --check
    - working-directory: examples/ssr-full
      run: cargo fmt --all -- --check
    - working-directory: examples/tauri
      run: cargo fmt --all -- --check
    - run: cargo install cargo-udeps --locked --version 0.1.43
    - run: cargo udeps --all-targets
    - working-directory: examples/ssr-full
      run: cargo udeps --all-targets
    - working-directory: examples/tauri
      run: cargo udeps --all-targets
  release-tests-ubuntu-latest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
    - uses: Swatinem/rust-cache@v2
    - run: cargo test --benches --tests --release
  release-tests-macos-latest:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
    - uses: Swatinem/rust-cache@v2
    - run: cargo test --benches --tests --release
  release-tests-windows-latest:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
    - uses: Swatinem/rust-cache@v2
    - run: cargo test --benches --tests --release
  tests-ubuntu-latest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        components: clippy
    - uses: Swatinem/rust-cache@v2
    - run: |
        sudo apt-get update
        sudo apt-get install -y webkit2gtk-4.0
    - run: mkdir -p examples/tauri/frontend/dist
    - run: cargo xtask codegen --check
    - run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - run: cargo test
    - run: cargo build --all-targets
    - run: cargo doc
    - working-directory: examples/ssr-full
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/ssr-full
      run: cargo test
    - working-directory: examples/ssr-full
      run: cargo build --all-targets
    - working-directory: examples/ssr-full
      run: cargo doc
    - working-directory: examples/tauri
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/tauri
      run: cargo test
    - working-directory: examples/tauri
      run: cargo build --all-targets
    - working-directory: examples/tauri
      run: cargo doc
    - run: cargo clippy --features declarative-shadow-dom --all-targets -- -D warnings -D clippy::all
    - run: cargo test --package silkenweb --features declarative-shadow-dom
  web-tests-ubuntu-latest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        target: wasm32-unknown-unknown
    - uses: Swatinem/rust-cache@v2
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - run: cargo install wasm-pack --locked --version 0.12.1
    - run: cargo install trunk --locked --version 0.17.2
    - working-directory: examples/todomvc
      run: trunk build
    - run: cargo xtask todomvc-cypress
    - working-directory: examples/todomvc/playwright
      run: npm ci
    - working-directory: examples/todomvc/playwright
      run: npx playwright install --with-deps
    - working-directory: examples/todomvc/playwright
      run: npx playwright install
    - working-directory: examples/todomvc/playwright
      run: npx playwright test
    - working-directory: examples/animation
      run: trunk build
    - working-directory: examples/async-http-request
      run: trunk build
    - working-directory: examples/bootstrap
      run: trunk build
    - working-directory: examples/client-server
      run: trunk build
    - working-directory: examples/component
      run: trunk build
    - working-directory: examples/counter
      run: trunk build
    - working-directory: examples/counter-list
      run: trunk build
    - working-directory: examples/css-modules
      run: trunk build
    - working-directory: examples/drag-and-drop
      run: trunk build
    - working-directory: examples/element-handle
      run: trunk build
    - working-directory: examples/hackernews-clone
      run: trunk build
    - working-directory: examples/hello-world
      run: trunk build
    - working-directory: examples/hydration
      run: trunk build
    - working-directory: examples/js-framework-benchmark
      run: trunk build
    - working-directory: examples/reactive-styles
      run: trunk build
    - working-directory: examples/router
      run: trunk build
    - working-directory: examples/shadow-root
      run: trunk build
    - working-directory: examples/timers
      run: trunk build
    - working-directory: examples/todomvc
      run: trunk build
    - working-directory: examples/web-components-wrapper
      run: trunk build
  tests-macos-latest:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        components: clippy
    - uses: Swatinem/rust-cache@v2
    - run: mkdir -p examples/tauri/frontend/dist
    - run: cargo xtask codegen --check
    - run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - run: cargo test
    - run: cargo build --all-targets
    - run: cargo doc
    - working-directory: examples/ssr-full
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/ssr-full
      run: cargo test
    - working-directory: examples/ssr-full
      run: cargo build --all-targets
    - working-directory: examples/ssr-full
      run: cargo doc
    - working-directory: examples/tauri
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/tauri
      run: cargo test
    - working-directory: examples/tauri
      run: cargo build --all-targets
    - working-directory: examples/tauri
      run: cargo doc
    - run: cargo clippy --features declarative-shadow-dom --all-targets -- -D warnings -D clippy::all
    - run: cargo test --package silkenweb --features declarative-shadow-dom
  web-tests-macos-latest:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        target: wasm32-unknown-unknown
    - uses: Swatinem/rust-cache@v2
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - run: cargo install wasm-pack --locked --version 0.12.1
    - run: cargo install trunk --locked --version 0.17.2
    - working-directory: examples/todomvc
      run: trunk build
    - run: cargo xtask todomvc-cypress
    - working-directory: examples/todomvc/playwright
      run: npm ci
    - working-directory: examples/todomvc/playwright
      run: npx playwright install --with-deps
    - working-directory: examples/todomvc/playwright
      run: npx playwright install
    - working-directory: examples/todomvc/playwright
      run: npx playwright test
    - working-directory: examples/animation
      run: trunk build
    - working-directory: examples/async-http-request
      run: trunk build
    - working-directory: examples/bootstrap
      run: trunk build
    - working-directory: examples/client-server
      run: trunk build
    - working-directory: examples/component
      run: trunk build
    - working-directory: examples/counter
      run: trunk build
    - working-directory: examples/counter-list
      run: trunk build
    - working-directory: examples/css-modules
      run: trunk build
    - working-directory: examples/drag-and-drop
      run: trunk build
    - working-directory: examples/element-handle
      run: trunk build
    - working-directory: examples/hackernews-clone
      run: trunk build
    - working-directory: examples/hello-world
      run: trunk build
    - working-directory: examples/hydration
      run: trunk build
    - working-directory: examples/js-framework-benchmark
      run: trunk build
    - working-directory: examples/reactive-styles
      run: trunk build
    - working-directory: examples/router
      run: trunk build
    - working-directory: examples/shadow-root
      run: trunk build
    - working-directory: examples/timers
      run: trunk build
    - working-directory: examples/todomvc
      run: trunk build
    - working-directory: examples/web-components-wrapper
      run: trunk build
  tests-windows-latest:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        components: clippy
    - uses: Swatinem/rust-cache@v2
    - run: mkdir -p examples/tauri/frontend/dist
    - run: cargo xtask codegen --check
    - run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - run: cargo test
    - run: cargo build --all-targets
    - run: cargo doc
    - working-directory: examples/ssr-full
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/ssr-full
      run: cargo test
    - working-directory: examples/ssr-full
      run: cargo build --all-targets
    - working-directory: examples/ssr-full
      run: cargo doc
    - working-directory: examples/tauri
      run: cargo clippy --all-targets -- -D warnings -D clippy::all
    - working-directory: examples/tauri
      run: cargo test
    - working-directory: examples/tauri
      run: cargo build --all-targets
    - working-directory: examples/tauri
      run: cargo doc
    - run: cargo clippy --features declarative-shadow-dom --all-targets -- -D warnings -D clippy::all
    - run: cargo test --package silkenweb --features declarative-shadow-dom
  web-tests-windows-latest:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: ructions/toolchain@v2
      with:
        toolchain: 1.73
        profile: minimal
        default: true
        target: wasm32-unknown-unknown
    - uses: Swatinem/rust-cache@v2
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - run: cargo install wasm-pack --locked --version 0.12.1
    - run: cargo install trunk --locked --version 0.17.2
    - working-directory: examples/todomvc
      run: trunk build
    - uses: cypress-io/github-action@v5
      with:
        working-directory: examples/todomvc/e2e
        start: npm start
        wait-on: 'http://localhost:8080'
